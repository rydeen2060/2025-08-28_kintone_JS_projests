# kintone ポータル カウントダウンタイマー

kintoneポータル画面に提出期限までのカウントダウンを表示するカスタマイズです。

## 機能

- 📅 **リアルタイムカウントダウン**: 提出期限までの残り時間を秒単位で表示
- ⏰ **自動更新**: 1秒ごとに表示を更新、5分ごとにデータを再取得
- 🎨 **レスポンシブデザイン**: モダンなカードレイアウトとCSSアニメーション
- ⚡ **高速表示**: データをキャッシュして効率的に動作
- 🔄 **ページング対応**: 500件以上のレコードにも対応
- ⚠️ **緊急通知**: 24時間以内の案件は点滅表示
- 🛡️ **エラーハンドリング**: 適切なバリデーションとエラー表示

## インストール方法

### 1. ファイルのダウンロード

以下のファイルをダウンロードしてください：
- `2026-01-05_document_timer.js`
- `2026-01-05_document_timer.css`

### 2. アプリの設定確認

カウントダウン対象のアプリに以下のフィールドが必要です：

| フィールド名 | フィールドコード | フィールドタイプ | 必須 |
|------------|----------------|----------------|-----|
| 提出期限 | `提出期限` | 日時 | ✓ |
| 期限終了 | `STATUS_FIELD` | ステータス管理 | ✓ |
| 書類名 | `書類名` | 文字列（1行） | ✓ |

**ステータス管理フィールドの選択肢:**
- 未終了（カウントダウン対象）
- 終了

### 3. 設定ファイルの編集

`2026-01-05_document_timer.js` を開き、以下の定数を環境に合わせて変更してください：

```javascript
const APP_ID = 287; // ⚠️ 実際のアプリIDに変更
const DEADLINE_FIELD = '提出期限'; // 日時フィールドのフィールドコード
const STATUS_FIELD = 'STATUS_FIELD'; // ステータスフィールドのフィールドコード
const NAME_FIELD = '書類名'; // 書類名フィールドのフィールドコード
const STATUS_VALUE_ACTIVE = '未終了'; // 進行中を示すステータスの値
```

### 4. ポータルへの適用

#### 4-1. コンテンツスペースの追加（推奨）

1. **kintone システム管理** > **ポータル** を開く
2. 対象のポータル（例：全員のポータル）をクリック
3. **ポータルの設定** をクリック
4. 左側のパーツ一覧から **「コンテンツスペース」** をドラッグ&ドロップで配置
5. **保存** をクリック

#### 4-2. JavaScript/CSSのアップロード

1. 同じポータル設定画面で **「JavaScript / CSSでカスタマイズ」** をクリック
2. 以下の順序でファイルをアップロード：
   - **PC用のCSSファイル**: `2026-01-05_document_timer.css`
   - **PC用のJavaScriptファイル**: `2026-01-05_document_timer.js`
3. **保存** をクリック

#### 4-3. 動作確認

ポータルをリロードして、カウントダウンが表示されることを確認してください。

## 表示イメージ

```
┌─────────────────────────────────────────────┐
│ 提出期限カウントダウン                       │
├─────────────────────────────────────────────┤
│ 📄 契約書A                                  │
│ 提出期限: 2026/01/10 17:00:00              │
│ 6日 14時間 23分 45秒                       │
├─────────────────────────────────────────────┤
│ 📄 報告書B (緊急) ⚠️                        │
│ 提出期限: 2026/01/04 12:00:00              │
│ 0日 8時間 12分 30秒 (点滅)                 │
└─────────────────────────────────────────────┘
```

## カスタマイズ

### 緊急判定の時間を変更

デフォルトでは24時間以内を緊急と判定します。変更する場合：

```javascript
// 2026-01-05_document_timer.js の89行目付近
const isUrgent = timeDiff < 24 * 60 * 60 * 1000; // 24時間以内

// 例: 48時間（2日）以内に変更
const isUrgent = timeDiff < 48 * 60 * 60 * 1000;
```

### データ再取得の間隔を変更

デフォルトでは5分ごとにデータを再取得します。変更する場合：

```javascript
// 2026-01-05_document_timer.js の160行目付近
setInterval(loadCountdowns, 5 * 60 * 1000); // 5分

// 例: 10分ごとに変更
setInterval(loadCountdowns, 10 * 60 * 1000);
```

### 最大取得レコード数の変更

```javascript
// 2026-01-05_document_timer.js の18行目
const MAX_RECORDS = 500; // 最大500件

// 例: 1000件に変更
const MAX_RECORDS = 1000;
```

### スタイルのカスタマイズ

`2026-01-05_document_timer.css` を編集して、色やサイズを変更できます：

```css
/* 緊急案件の色 */
.countdown-item.urgent .countdown-timer {
  color: #c0392b; /* 赤色 */
}

/* カウントダウンタイマーのフォントサイズ */
.countdown-timer {
  font-size: 18px; /* お好みのサイズに */
}
```

## トラブルシューティング

### エラー: 「ポータルのコンテンツスペースが見つかりません」

**原因**: ポータルにコンテンツスペースが設定されていない

**解決方法**:
1. ポータル設定で「コンテンツスペース」パーツを追加
2. または、コードが自動的にポータル本体に挿入します（フォールバック機能）

### エラー: 「指定されたフィールド（xxx）が見つかりません」

**原因**: フィールドコードが正しくない

**解決方法**:
1. アプリの設定 > フォーム でフィールドコードを確認
2. `2026-01-05_document_timer.js` の定数を正しい値に修正

### エラー: 「演算子=を使用できません」

**原因**: ステータス管理フィールドで `=` 演算子を使っている

**解決方法**: このコードでは既に `in` 演算子を使用しているため、このエラーは発生しません。

### カウントダウンが表示されない

**確認事項**:
1. APP_IDが正しいか
2. フィールドコードが正しいか
3. 「未終了」のレコードが存在するか
4. ブラウザのコンソールにエラーが出ていないか

## 仕様

### 対応ブラウザ

- Google Chrome（最新版）
- Microsoft Edge（最新版）
- Firefox（最新版）
- Safari（最新版）

### パフォーマンス

- **初回読み込み**: アプリからレコードを取得（通常1秒以内）
- **表示更新**: 1秒ごと（軽量処理、CPU負荷ほぼなし）
- **データ再取得**: 5分ごと

### 制限事項

- ポータル専用（アプリ画面では動作しません）
- 最大取得レコード数: 500件（設定で変更可能）
- スマートフォン表示には未対応（PC用のみ）

## ライセンス

MIT License

## 作成者

- 🤖 Generated with [Claude Code](https://claude.com/claude-code)
- Co-Authored-By: Claude <noreply@anthropic.com>

## バージョン履歴

### v1.0.0 (2026-01-05)
- 初回リリース
- リアルタイムカウントダウン機能
- ステータス管理フィールド対応
- エラーハンドリング実装
- レスポンシブデザイン
